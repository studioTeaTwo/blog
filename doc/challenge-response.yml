@startuml
== challenge phase ==
user -> server: Challenge Request
note left: NostrPubKey
server -> server: Create macaroon
server -> LND: Invoice Request
server <-- LND: Invoice Response
user <-- server: Challenge Response
note right: macaroon + invoice

== answer creation ==

user -> LND: Payment
note left: invoice
server <-- LND: Settlement nortification
server -> server: Get the preimage
server -> Nostr: Event Request
note left
  the preimage encrypted
  by NostrPubKey
end note

user <-- Nostr: Event Response
user -> user: Decrypt the preimage by NostrSecKey

== response phase ==

user -> server: Answer Request
note left: macaroon + preimage
server -> server: Verify
user <-- server: Answer Response
@enduml